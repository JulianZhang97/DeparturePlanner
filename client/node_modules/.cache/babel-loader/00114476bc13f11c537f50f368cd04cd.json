{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\zhang\\\\OneDrive\\\\Documents\\\\Personal Projects\\\\departure-planner\\\\react-backend\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\zhang\\\\OneDrive\\\\Documents\\\\Personal Projects\\\\departure-planner\\\\react-backend\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\zhang\\\\OneDrive\\\\Documents\\\\Personal Projects\\\\departure-planner\\\\react-backend\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\zhang\\\\OneDrive\\\\Documents\\\\Personal Projects\\\\departure-planner\\\\react-backend\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\zhang\\\\OneDrive\\\\Documents\\\\Personal Projects\\\\departure-planner\\\\react-backend\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\zhang\\\\OneDrive\\\\Documents\\\\Personal Projects\\\\departure-planner\\\\react-backend\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"C:\\\\Users\\\\zhang\\\\OneDrive\\\\Documents\\\\Personal Projects\\\\departure-planner\\\\react-backend\\\\client\\\\src\\\\components\\\\ResultPage.js\";\n\n/* global google */\nimport React, { Component } from 'react';\nimport ReactLoading from 'react-loading';\nimport { withScriptjs, GoogleMap, withGoogleMap, DirectionsRenderer } from 'react-google-maps';\nimport { compose, withProps, lifecycle } from 'recompose';\nimport Header from './Header.js';\nimport axios from 'axios';\nvar MapWithADirectionsRenderer = compose(withProps({\n  loadingElement: React.createElement(\"div\", {\n    style: {\n      height: \"100%\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 19\n    },\n    __self: this\n  }),\n  containerElement: React.createElement(\"div\", {\n    style: {\n      height: \"400px\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 20\n    },\n    __self: this\n  }),\n  mapElement: React.createElement(\"div\", {\n    style: {\n      height: \"75%\",\n      width: \"100%\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 21\n    },\n    __self: this\n  })\n}), // withState('mapPane', 'onMapLoad'),\n// withHandlers(() => {\n//   const refs = {\n//     map: undefined,\n//   }\n//   return {\n//     onMapMounted: () => ref => {\n//       refs.map = ref;\n//     },\n//     onMapChanged: ({ onMapLoad }) => () => {\n//       onMapLoad(refs.map)\n//     }\n//   }\n// }),\nwithScriptjs, withGoogleMap, lifecycle({\n  componentDidMount: function componentDidMount() {\n    var _this = this;\n\n    var DirectionsService = new google.maps.DirectionsService();\n    DirectionsService.route({\n      origin: this.props.origin,\n      destination: this.props.destination,\n      travelMode: this.props.travelMode,\n      drivingOptions: this.props.drivingOptions\n    }, function (result, status) {\n      if (status === google.maps.DirectionsStatus.OK) {\n        console.log(result.routes[0].legs[0]);\n\n        _this.setState({\n          directions: result\n        });\n      } else {\n        console.error(\"error fetching directions \".concat(result));\n      }\n    });\n  }\n}))(function (props) {\n  return React.createElement(GoogleMap, {\n    defaultCenter: new google.maps.LatLng(41.8507300, -87.6512600),\n    options: {\n      disableDefaultUI: true,\n      gestureHandling: \"none\"\n    } // ref={props.onMapMounted}\n    // onTilesLoaded={props.onMapChanged}\n    ,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61\n    },\n    __self: this\n  }, props.directions && React.createElement(DirectionsRenderer, {\n    directions: props.directions,\n    panel: props.mapRef,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73\n    },\n    __self: this\n  }));\n});\n\nvar ResultPage =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ResultPage, _Component);\n\n  function ResultPage(props) {\n    var _this2;\n\n    _classCallCheck(this, ResultPage);\n\n    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(ResultPage).call(this, props));\n    _this2.state = {\n      departureSite: _this2.props.location.state.departureSite,\n      arrivalSite: _this2.props.location.state.arrivalSite,\n      airline: _this2.props.location.state.airline,\n      flightNum: _this2.props.location.state.flightNum,\n      flightDate: _this2.props.location.state.flightDate,\n      departureDetailsLoaded: false,\n      departureTime: \"\",\n      departureTimeZone: \"\",\n      flightExists: null,\n      curTime: new Date(),\n      mapsAPI: \"\",\n      testOrigin: \"Eaton Centre\",\n      testDest: \"YYZ\",\n      travelMode: \"DRIVING\",\n      drivingOptions: {\n        departureTime: new Date(),\n        trafficModel: 'optimistic'\n      }\n    };\n    _this2.searchFlight = _this2.searchFlight.bind(_assertThisInitialized(_assertThisInitialized(_this2)));\n    _this2.getDepartureDetails = _this2.getDepartureDetails.bind(_assertThisInitialized(_assertThisInitialized(_this2)));\n    return _this2;\n  }\n\n  _createClass(ResultPage, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      console.log(this.state);\n      var apiKey = process.env.REACT_APP_GOOGLE_API_KEY;\n      this.setState({\n        mapsAPI: apiKey\n      }); //  this.searchFlight();\n    }\n  }, {\n    key: \"searchFlight\",\n    value: function searchFlight() {\n      var flightSearchKey = process.env.REACT_APP_FLIGHT_API_KEY;\n      var proxyurl = \"https://cors-anywhere.herokuapp.com/\";\n      var init = {\n        headers: {\n          \"Ocp-Apim-Subscription-Key\": flightSearchKey\n        },\n        params: {\n          \"Airline\": this.state.airline,\n          \"FlightNumber\": this.state.flightNum\n        }\n      };\n      var self = this;\n      axios.get(proxyurl + \"https://flightlookup.azure-api.net/v1/xml/TimeTable/\" + this.state.departureSite + \"/\" + this.state.arrivalSite + \"/\" + this.state.flightDate, init).then(function (response) {\n        // console.log(response.data);\n        self.getDepartureDetails(response.data);\n      }).catch(function (error) {\n        console.log(error);\n      });\n    }\n  }, {\n    key: \"getDepartureDetails\",\n    value: function getDepartureDetails(flightData) {\n      var parser = new DOMParser();\n      var xmlDoc = parser.parseFromString(flightData, \"text/xml\");\n\n      if (!xmlDoc.getElementsByTagName(\"Success\").length === 0) {\n        console.log(\"Search Failed!\");\n        this.setState({\n          flightExists: false,\n          departureDetailsLoaded: true\n        });\n      } else {\n        var flightDepartureTime = xmlDoc.getElementsByTagName(\"FlightDetails\")[0].getAttribute(\"FLSDepartureDateTime\");\n        var flightDepartureTimeZone = xmlDoc.getElementsByTagName(\"FlightDetails\")[0].getAttribute(\"FLSDepartureTimeOffset\");\n        this.setState({\n          departureTime: flightDepartureTime,\n          departureTimeZone: flightDepartureTimeZone\n        });\n        this.setState({\n          flightExists: true,\n          departureDetailsLoaded: true\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175\n        },\n        __self: this\n      }, React.createElement(Header, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178\n        },\n        __self: this\n      }, this.state.mapsAPI !== \"\" && React.createElement(\"div\", {\n        className: \"mapPane\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180\n        },\n        __self: this\n      }, React.createElement(MapWithADirectionsRenderer, {\n        origin: this.state.testOrigin,\n        destination: this.state.testDest,\n        travelMode: this.state.travelMode,\n        drivingOptions: this.state.drivingOptions,\n        googleMapURL: \"https://maps.googleapis.com/maps/api/js?key=\" + this.state.mapsAPI + \"&v=3.exp&libraries=geometry,drawing,places\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181\n        },\n        __self: this\n      })), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189\n        },\n        __self: this\n      }, this.state.departureSite), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      }, this.state.arrivalSite), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        },\n        __self: this\n      }, this.state.airline), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }, this.state.flightNum), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }, this.state.departureTime), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194\n        },\n        __self: this\n      }, this.state.departureTimeZone)));\n    }\n  }]);\n\n  return ResultPage;\n}(Component);\n\nexport { ResultPage as default };","map":{"version":3,"sources":["C:\\Users\\zhang\\OneDrive\\Documents\\Personal Projects\\departure-planner\\react-backend\\client\\src\\components\\ResultPage.js"],"names":["React","Component","ReactLoading","withScriptjs","GoogleMap","withGoogleMap","DirectionsRenderer","compose","withProps","lifecycle","Header","axios","MapWithADirectionsRenderer","loadingElement","height","containerElement","mapElement","width","componentDidMount","DirectionsService","google","maps","route","origin","props","destination","travelMode","drivingOptions","result","status","DirectionsStatus","OK","console","log","routes","legs","setState","directions","error","LatLng","disableDefaultUI","gestureHandling","mapRef","ResultPage","state","departureSite","location","arrivalSite","airline","flightNum","flightDate","departureDetailsLoaded","departureTime","departureTimeZone","flightExists","curTime","Date","mapsAPI","testOrigin","testDest","trafficModel","searchFlight","bind","getDepartureDetails","apiKey","process","env","REACT_APP_GOOGLE_API_KEY","flightSearchKey","REACT_APP_FLIGHT_API_KEY","proxyurl","init","headers","params","self","get","then","response","data","catch","flightData","parser","DOMParser","xmlDoc","parseFromString","getElementsByTagName","length","flightDepartureTime","getAttribute","flightDepartureTimeZone"],"mappings":"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","sourcesContent":["/* global google */\r\n\r\nimport React, { Component } from 'react';\r\nimport ReactLoading from 'react-loading';\r\n\r\nimport { withScriptjs, GoogleMap, withGoogleMap, DirectionsRenderer} from 'react-google-maps';\r\nimport { compose, withProps, lifecycle} from 'recompose'\r\n\r\n\r\nimport Header from './Header.js';\r\n\r\nimport axios from 'axios'\r\n\r\n\r\n\r\n\r\nconst MapWithADirectionsRenderer = compose(\r\n  withProps({\r\n    loadingElement: <div style={{ height: `100%` }} />,\r\n    containerElement: <div style={{ height: `400px` }} />,\r\n    mapElement: <div style={{ height: `75%`, width: `100%` }} />,\r\n  }),\r\n  // withState('mapPane', 'onMapLoad'),\r\n  // withHandlers(() => {\r\n  //   const refs = {\r\n  //     map: undefined,\r\n  //   }\r\n  //   return {\r\n  //     onMapMounted: () => ref => {\r\n  //       refs.map = ref;\r\n  //     },\r\n  //     onMapChanged: ({ onMapLoad }) => () => {\r\n  //       onMapLoad(refs.map)\r\n  //     }\r\n  //   }\r\n  // }),\r\n  withScriptjs,\r\n  withGoogleMap,\r\n  lifecycle({\r\n    componentDidMount() {\r\n      const DirectionsService = new google.maps.DirectionsService();\r\n      DirectionsService.route({\r\n        origin: this.props.origin,\r\n        destination: this.props.destination,\r\n        travelMode: this.props.travelMode,\r\n        drivingOptions: this.props.drivingOptions}, \r\n        \r\n        (result, status) => {\r\n        if (status === google.maps.DirectionsStatus.OK) {\r\n          console.log(result.routes[0].legs[0]);\r\n          this.setState({\r\n            directions: result,\r\n          });\r\n        } else {\r\n          console.error(`error fetching directions ${result}`);\r\n        }\r\n      });\r\n    }\r\n  })\r\n)(props =>\r\n  <GoogleMap\r\n    defaultCenter={new google.maps.LatLng(41.8507300, -87.6512600)}\r\n    options={({\r\n      disableDefaultUI: true,\r\n      gestureHandling: \"none\",\r\n\r\n    })}\r\n\r\n    // ref={props.onMapMounted}\r\n    // onTilesLoaded={props.onMapChanged}\r\n    >\r\n    {props.directions && \r\n    <DirectionsRenderer \r\n    directions={props.directions} \r\n    panel={props.mapRef}\r\n    />\r\n    }\r\n  </GoogleMap>\r\n);\r\n\r\n\r\nexport default class ResultPage extends Component {\r\n  constructor(props){\r\n    super(props)\r\n    this.state = {\r\n      departureSite: this.props.location.state.departureSite,\r\n      arrivalSite: this.props.location.state.arrivalSite,\r\n      airline: this.props.location.state.airline,\r\n      flightNum: this.props.location.state.flightNum,\r\n      flightDate: this.props.location.state.flightDate,\r\n\r\n      departureDetailsLoaded: false,\r\n      departureTime: \"\",\r\n      departureTimeZone: \"\",\r\n      flightExists: null,\r\n      curTime: new Date(),\r\n\r\n      mapsAPI: \"\", \r\n\r\n\r\n\r\n      testOrigin: \"Eaton Centre\",\r\n      testDest: \"YYZ\",\r\n      travelMode: \"DRIVING\",\r\n      drivingOptions: {\r\n        departureTime: new Date(),\r\n        trafficModel: 'optimistic'\r\n      },\r\n    }\r\n\r\n    this.searchFlight = this.searchFlight.bind(this);\r\n    this.getDepartureDetails = this.getDepartureDetails.bind(this);\r\n  }\r\n\r\n  componentDidMount(){\r\n      console.log(this.state);\r\n\r\n      const apiKey = process.env.REACT_APP_GOOGLE_API_KEY;\r\n      this.setState({mapsAPI: apiKey})\r\n\r\n  //  this.searchFlight();\r\n  }\r\n\r\n  searchFlight(){\r\n    const flightSearchKey = process.env.REACT_APP_FLIGHT_API_KEY;\r\n    const proxyurl = \"https://cors-anywhere.herokuapp.com/\";\r\n    \r\n    const init = {\r\n      headers: {\r\n        \"Ocp-Apim-Subscription-Key\": flightSearchKey\r\n      },\r\n      params: {\r\n        \"Airline\": this.state.airline,\r\n        \"FlightNumber\": this.state.flightNum,\r\n      }\r\n    }\r\n\r\n    var self = this;\r\n\r\n    axios.get(proxyurl + \"https://flightlookup.azure-api.net/v1/xml/TimeTable/\" \r\n    + this.state.departureSite + \"/\" + this.state.arrivalSite + \"/\" \r\n    + this.state.flightDate, init)\r\n    .then(function (response) {\r\n      // console.log(response.data);\r\n      self.getDepartureDetails(response.data);      \r\n    })\r\n    .catch(function (error) {\r\n      console.log(error);\r\n    });\r\n\r\n  }\r\n\r\n  getDepartureDetails(flightData){\r\n    var parser = new DOMParser();\r\n    var xmlDoc = parser.parseFromString(flightData,\"text/xml\");\r\n    \r\n   \r\n    if(!xmlDoc.getElementsByTagName(\"Success\").length === 0){\r\n      console.log(\"Search Failed!\");\r\n      this.setState({flightExists: false, departureDetailsLoaded: true});\r\n    }\r\n\r\n    else{\r\n      var flightDepartureTime = xmlDoc.getElementsByTagName(\"FlightDetails\")[0].getAttribute(\"FLSDepartureDateTime\");\r\n      var flightDepartureTimeZone = xmlDoc.getElementsByTagName(\"FlightDetails\")[0].getAttribute(\"FLSDepartureTimeOffset\");\r\n\r\n      this.setState({departureTime: flightDepartureTime, departureTimeZone: flightDepartureTimeZone});\r\n      this.setState({flightExists: true, departureDetailsLoaded: true});\r\n    }\r\n  }\r\n\r\n\r\n  render(){\r\n    return(\r\n      <div>\r\n          <Header>\r\n          </Header>\r\n            <div>\r\n                {this.state.mapsAPI !== \"\" && \r\n                <div className=\"mapPane\">        \r\n                  <MapWithADirectionsRenderer \r\n                    origin={this.state.testOrigin} \r\n                    destination={this.state.testDest} \r\n                    travelMode={this.state.travelMode} \r\n                    drivingOptions={this.state.drivingOptions}\r\n                    googleMapURL={\"https://maps.googleapis.com/maps/api/js?key=\" + this.state.mapsAPI + \"&v=3.exp&libraries=geometry,drawing,places\"}/> \r\n                </div>\r\n                }\r\n              <p>{this.state.departureSite}</p>\r\n              <p>{this.state.arrivalSite}</p>\r\n              <p>{this.state.airline}</p>\r\n              <p>{this.state.flightNum}</p>\r\n              <p>{this.state.departureTime}</p>\r\n              <p>{this.state.departureTimeZone}</p>\r\n            </div>\r\n    </div>\r\n    );\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}